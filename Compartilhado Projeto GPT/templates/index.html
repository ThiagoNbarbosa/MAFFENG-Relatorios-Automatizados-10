{% extends "base.html" %}
{% from "form_generator.html" import render_section %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h2 class="text-3xl font-bold mb-4">Gerador de Relatórios Fotográficos</h2>
        <p class="text-gray-300">Faça upload de um arquivo ZIP com suas fotos organizadas em pastas e gere relatórios Word profissionais automaticamente.</p>
    </div>
    
    <!-- Form -->
    <form id="uploadForm" action="{{ url_for('processar_upload') }}" method="POST" enctype="multipart/form-data" class="space-y-8">
        
        <!-- Campos básicos obrigatórios -->
        <div class="glass-card p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-file-alt mr-3 text-green-400"></i>
                Informações Básicas
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Nome do Projeto *</label>
                    <input type="text" name="nome_projeto" required 
                           class="form-input w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Digite o nome do projeto">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Modelo do Relatório *</label>
                    <select name="modelo_selecionado" required 
                            class="form-select w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Selecione o modelo</option>
                        {% for key, nome in modelos.items() %}
                        <option value="{{ key }}">{{ nome }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Seções dinâmicas baseadas na configuração -->
        {% for section_key, section_data in placeholders.items() %}
            {% if section_key != 'empresa' %}
                {{ render_section(section_key, section_data, estados, section_icons) }}
            {% endif %}
        {% endfor %}

        <!-- Seção de arquivos -->
        <div class="glass-card p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-file-upload mr-3 text-orange-400"></i>
                Arquivo de Fotos
            </h3>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Arquivo ZIP com Fotos *</label>
                <div class="relative">
                    <input type="file" 
                           id="arquivo_zip" 
                           name="arquivo_zip" 
                           accept=".zip" 
                           required 
                           class="hidden">
                    <div class="border-2 border-dashed border-white/30 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-500/10 transition-all"
                         onclick="document.getElementById('arquivo_zip').click()">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p id="file-name" class="text-lg mb-2">Selecionar arquivo ZIP</p>
                        <p class="text-sm text-gray-400">Máximo 100MB - Apenas arquivos .zip</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informações da empresa (campos fixos - somente visualização) -->
        {% if placeholders.empresa %}
        <div class="glass-card p-6 rounded-lg bg-gray-800/50">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-industry mr-3 text-purple-400"></i>
                Informações da Empresa (Configuradas)
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for field_key, config in placeholders.empresa.placeholders.items() %}
                    {% if config.type == 'fixed' %}
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-400">{{ config.label }}</label>
                        <div class="px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-300">
                            {{ config.value }}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
            <p class="text-xs text-gray-500 mt-3">
                <i class="fas fa-info-circle mr-1"></i>
                Estes valores são configurados automaticamente. 
                <a href="{{ url_for('configuracoes') }}" class="text-blue-400 hover:text-blue-300">Alterar configurações</a>
            </p>
        </div>
        {% endif %}

        <!-- Botão de submit -->
        <div class="text-center">
            <button type="submit" id="submitBtn" class="btn-primary px-8 py-3 rounded-lg text-lg font-semibold hover:opacity-90 transition-all">
                <span id="btn-text">
                    <i class="fas fa-cog mr-2"></i>
                    Gerar Relatório
                </span>
            </button>
        </div>

        <!-- Progress indicator (hidden initially) -->
        <div id="progress-container" class="hidden">
            <div class="glass-card p-4 rounded-lg">
                <div class="flex items-center justify-center space-x-4">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
                    <span id="progress-text">Processando arquivo...</span>
                </div>
                <div class="w-full bg-gray-200/20 rounded-full h-2 mt-4">
                    <div id="progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </form>
</div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}